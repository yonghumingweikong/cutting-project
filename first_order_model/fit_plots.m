clc; close all;

data = [28.94337267	54.99121265	7.499709869	6.036431562;
90.48879084	22.73359287	16.67794311	3.214623788;
92.76390883	61.82712589	-16.39101739	4.580556441;
26.75427059	97.33687277	6.034954101	5.763640855;
23.47174523	85.10168926	-1.444062721	8.885473699;
16.30657101	30.9900807	-4.863730017	9.080408374;
76.30907793	18.86384664	2.104956386	3.247175667;
57.05491442	29.05260539	-37.83500801	1.345229539;
4.213260187	11.59397691	27.62400245	6.414680652;
63.92618285	87.57888181	8.66844883	3.684479407;
-24.63027969	54.93214163	-21.12633776	-0.4300624034;
47.29402412	24.85636514	47.30878865	0.8882987592;
81.63106781	-30.97862549	9.070029529	-7.32373231;
6.873047975	57.70954756	-2.016687342	9.744116606;
5.335021136	54.10821461	-16.04987124	5.721960952;
24.54566633	68.03878907	-17.80534829	3.470732909;
25.1534815	64.11647379	-26.19347955	7.320962794;
50.37871032	48.16773593	-12.85472676	8.072570833;
-55.76195752	53.65397549	20.67161075	-4.982161378;
9.359902856	62.52892871	-3.034543918	7.03875338;
14.21797418	45.9986008	4.66936459	8.927583799;
87.90581478	-20.10475355	-64.28621726	-9.985417643;
30.21797577	37.76448807	-15.55051985	0.4475274647;
71.67371115	58.84743169	-23.38832013	1.121126309;
-45.77814416	47.40925267	38.14560522	-0.6241312091;
9.684538324	42.63020104	18.87613864	8.338763532;
17.54257524	39.66288192	-54.16775623	0.3915098036;
-26.38488915	15.79049892	-64.16759968	-2.883848205;
52.9676189	-66.84715436	-13.0425517	-5.125646989;
-8.903200806	78.22310135	17.89070254	-6.21579866;
47.1090466	71.26003127	-33.17193417	0.2599530676;
14.30425718	84.21906072	-15.00917536	7.960576244;
-63.6072878	59.99194248	6.925551509	-1.257298356;
76.16913236	36.23994452	-7.089545607	5.099402909;
-48.83015177	37.75659888	-73.87367032	-6.599898579;
-34.85796052	46.5065343	65.81801339	-0.579276497;
33.5840575	78.74964026	-24.52021309	7.729725104;
55.56803372	16.24136018	-82.19053047	3.344402818;
-69.21553904	70.19707846	44.3755663	-1.878145333;
56.47713943	54.13918888	-15.00148138	3.458531187;
36.57725636	17.94089752	-44.15459752	0.5242818393;
-48.04135604	59.40148617	-99.74585363	-0.9313687749;
51.78170577	71.11351678	97.96525089	6.574412022;
18.32124584	50.33202713	-9.527520558	3.688074052;
59.65493089	42.55186676	-28.11800874	0.9327897805;
82.89585329	42.60251601	-9.90284421	3.540462279;
-2.325643017	27.32307723	38.60649774	-0.05936275776;
-35.63043457	56.53949489	96.54391725	-6.215832379;
-32.22663246	32.0935644	-9.877188928	-0.3562894164;
24.17376003	54.07265002	-12.83084035	1.272069127;
-47.94453524	51.4511604	9.726612941	-0.7561570265;
-56.99441368	63.34027094	-17.45543841	-1.12949665;
21.68337885	74.62547299	8.938351213	8.054487979;
51.31166714	60.71055311	-16.33857323	3.70431155;
30.73780794	55.2262165	-9.965443252	7.912362144;
21.58225857	66.09186087	-5.787625849	6.68566087;
32.17240143	22.18418466	82.99433795	7.217463635;
46.96731892	52.23507366	-11.37554069	5.263777523;
33.73732303	60.8450083	-16.57844277	3.120283818;
24.73845384	54.39895191	2.909404906	6.97662946;
21.40345007	88.94474844	-4.46268469	7.624323228;
8.652443499	32.86595393	16.02867597	9.060042196;
76.49062865	77.29322502	-22.82564102	4.405055216;
16.5159996	64.70688504	-4.805566665	4.103049149
];

profiles = zeros(height(profiles_1)+height(profiles_2)+height(profiles_5),length(profiles_1));
profiles(1:20,:) = profiles_1;
profiles(21:52,:) = profiles_2;
profiles(53:end,:) = profiles_5;

for n = 1:height(profiles)
    M = find(profiles(n,:),1,'last');
    actual = profiles(n,1:M);
    
    Kp = data(n,1);
    l1 = data(n,2);
    l2 = data(n,3);
    b0 = data(n,4);
    
    y = ADRC_FO_rollout(Kp,l1,l2,b0,reference(1:M),Ts);
    
    clf;
    plot(y); hold on;
    plot(actual); grid on;
    legend('model','actual');
    saveas(gcf,'./first_order_model/img/'+string(n)+'.png')
end